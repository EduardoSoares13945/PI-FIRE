<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Localização</title>
  <link rel="stylesheet" href="localizacao-styles.css"/>
</head>
<body>
  <header class="topbar">
    <button class="menu" aria-label="Abrir menu">
      <span></span><span></span><span></span>
    </button>

    <h1>Localização</h1>

    <div class="usuario">
      <img src="https://cdn-icons-png.flaticon.com/512/456/456212.png" alt="">
      <span id="usuario-logado">Usuário</span>
    </div>
  </header>

  <main class="container">
    <h2 class="instrucao">Preencha as informações a seguir:</h2>

    <form id="form-endereco" class="grid">
      <div class="campo">
        <label for="endereco">Endereço</label>
        <input id="endereco" name="endereco" type="text" placeholder="Rua/Avenida" required />
      </div>

      <div class="campo">
        <label for="bairro">Bairro</label>
        <input id="bairro" name="bairro" type="text" placeholder="Bairro" required />
      </div>

      <div class="campo">
        <label for="cep">CEP</label>
        <input id="cep" name="cep" type="text" inputmode="numeric" maxlength="9"
               placeholder="00000-000" pattern="^\d{5}-?\d{3}$" />
      </div>

      <div class="campo">
        <label for="numero">Número</label>
        <input id="numero" name="numero" type="text" placeholder="Nº" />
      </div>

      <div class="campo">
        <label for="complemento">Complemento</label>
        <input id="complemento" name="complemento" type="text" placeholder="Apto/Bloco/Quadra" />
      </div>

      <div class="campo">
        <label for="referencia">Ponto de referência</label>
        <input id="referencia" name="referencia" type="text" placeholder="Digite..." />
      </div>

      <div class="acoes">
        <button type="button" class="btn voltar" id="btn-voltar">⬅️ Voltar</button>
        <button type="submit" class="btn confirmar" id="btn-confirmar">✅ Confirmar</button>
      </div>
    </form>
  </main>

  <script>
    // mostra o usuário (usando o que já salvamos no login)
    const u = localStorage.getItem("usuarioEmail");
    if (u) {
      document.getElementById("usuario-logado").textContent = u;
    } else {
      // sem login? volta
      window.location.href = "login.html";
    }

    // se cidade já foi escolhida na tela anterior, guarda no form (opcional)
    const cidade = localStorage.getItem("cidadeSelecionada") || "";
    if (cidade) {
      // preenche endereço com cidade para ajudar
      document.getElementById("referencia").placeholder = `Ex.: Próximo ao centro de ${cidade}`;
    }

    // máscara simples de CEP
    
    const cepInput = document.getElementById("cep");
    cepInput.addEventListener("input", () => {
      let v = cepInput.value.replace(/\D/g, "").slice(0, 8);
      if (v.length > 5) v = v.slice(0,5) + "-" + v.slice(5);
      cepInput.value = v;
    });

    // ações
    document.getElementById("btn-voltar").addEventListener("click", () => history.back());

    document.getElementById("form-endereco").addEventListener("submit", (e) => {
      e.preventDefault();

      // salva no localStorage (você pode enviar ao backend depois)
      const dados = {
        endereco: document.getElementById("endereco").value.trim(),
        bairro: document.getElementById("bairro").value.trim(),
        cep: document.getElementById("cep").value.trim(),
        numero: document.getElementById("numero").value.trim(),
        complemento: document.getElementById("complemento").value.trim(),
        referencia: document.getElementById("referencia").value.trim(),
        cidadeSelecionada: cidade
      };
      localStorage.setItem("enderecoOcorrencia", JSON.stringify(dados));

      alert("Localização salva com sucesso!");
      window.location.href = "criar_ocorrencia.html";
    });
  </script>
</body>
</html>

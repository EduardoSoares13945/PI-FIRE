<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bem vindo ao FIRE</title>
  <link rel="stylesheet" href="fire-style.css">
</head>
<body>
  <header>
    <h1>Bem vindo ao FIRE</h1>
    <div class="usuario">
      <img src="https://cdn-icons-png.flaticon.com/512/456/456212.png" alt="Usu√°rio">
      <span><h2 id="usuario-logado"></h2></span>
    </div>
  </header>

  <main>
    <section class="conteudo">
      <div class="mapa-container">
        <iframe id="map"
          src="https://www.google.com/maps?q=Recife&output=embed"
          width="400" height="300" style="border:0;" allowfullscreen="" loading="lazy">
        </iframe>
      </div>

      <div class="opcoes">
        <p id="texto-principal">Utilize a localiza√ß√£o atual ou selecione a cidade da ocorr√™ncia:</p>
        <div class="botoes" id="botoes-principais">
          <button class="btn localizacao" id="btn-localizacao">üìç Localiza√ß√£o Atual</button>
          <button class="btn pesquisar" id="btn-pesquisar">üåê Pesquisar local</button>
        </div>

        <!-- Campo de pesquisa (inicialmente oculto) -->
        <div class="pesquisa-cidade" id="campo-pesquisa" style="display: none;">
          <p>Digite o nome da cidade para efetuar o registro:</p>
          <input type="text" id="cidade" placeholder="Digite aqui..." />
          <div class="botoes">
            <button class="btn voltar" id="btn-voltar">üîô Voltar</button>
            <button class="btn confirmar" id="btn-confirmar">‚úÖ Confirmar</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- login guard + sauda√ß√£o -->
  <script>
    const usuarioEmail = localStorage.getItem("usuarioEmail");
    if (usuarioEmail) {
      document.getElementById("usuario-logado").textContent = `Bem-vindo, ${usuarioEmail}!`;
    } else {
      window.location.href = "pages/login.html";
    }
  </script>

  <!-- l√≥gica de pesquisa/armazenamento da cidade + mapa din√¢mico -->
  <script>
    const btnPesquisar = document.getElementById("btn-pesquisar");
    const campoPesquisa = document.getElementById("campo-pesquisa");
    const botoesPrincipais = document.getElementById("botoes-principais");
    const textoPrincipal = document.getElementById("texto-principal");
    const btnVoltar = document.getElementById("btn-voltar");
    const btnConfirmar = document.getElementById("btn-confirmar");
    const inputCidade = document.getElementById("cidade");
    const map = document.getElementById("map");

    // üëâ se houver cidade salva, j√° abre o mapa nela
    const cidadeSalva = localStorage.getItem("cidadeSelecionada");
    if (cidadeSalva) {
      map.src = `https://www.google.com/maps?q=${encodeURIComponent(cidadeSalva)}&output=embed`;
    }

    btnPesquisar.addEventListener("click", () => {
      campoPesquisa.style.display = "block";
      botoesPrincipais.style.display = "none";
      textoPrincipal.textContent = "Pesquisa de Localiza√ß√£o";
      inputCidade.value = cidadeSalva || "";
      setTimeout(() => inputCidade.focus(), 0);
    });

    btnVoltar.addEventListener("click", () => {
      campoPesquisa.style.display = "none";
      botoesPrincipais.style.display = "flex";
      textoPrincipal.textContent = "Utilize a localiza√ß√£o atual ou selecione a cidade da ocorr√™ncia:";
    });

    // tecla Enter confirma tamb√©m
    inputCidade.addEventListener("keydown", (e) => {
      if (e.key === "Enter") btnConfirmar.click();
    });

    // bot√£o confirmar ‚Äî salva e redireciona
    btnConfirmar.addEventListener("click", () => {
      const cidade = inputCidade.value.trim();
      if (!cidade) {
        alert("Por favor, digite o nome da cidade!");
        inputCidade.focus();
        return;
      }

      // salva e atualiza o mapa
      localStorage.setItem("cidadeSelecionada", cidade);
      map.src = `https://www.google.com/maps?q=${encodeURIComponent(cidade)}&output=embed`;

      // redireciona para a pr√≥xima p√°gina
      window.location.href = "localizacao.html";
    });

    // (opcional) usar geolocaliza√ß√£o do navegador para "Localiza√ß√£o Atual"
    document.getElementById("btn-localizacao").addEventListener("click", () => {
      if (!navigator.geolocation) {
        alert("Geolocaliza√ß√£o n√£o suportada neste navegador.");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const { latitude, longitude } = pos.coords;
          localStorage.setItem("cidadeSelecionada", `${latitude},${longitude}`);
          map.src = `https://www.google.com/maps?q=${latitude},${longitude}&output=embed`;
        },
        () => alert("N√£o foi poss√≠vel obter sua localiza√ß√£o.")
      );
    });
  </script>
</body>
</html>
